function tileIndexToGridPosition(a){var b=0,c=0,d=function(a,b){return a==0?0:a%b==0?b-1:a%b-1};a-=1,b=d(a+1,mapData.width),c=Math.floor(a/mapData.width);return{x:b,y:c}}function generatePlateauGrid(){var a=0;mapData.plateauGrid=[];for(var b,c=0;c<mapData.height;c++){mapData.plateauGrid[c]=[];for(b=0;b<mapData.width;b++)_.include(mapData.plateau,a)?mapData.plateauGrid[c][b]=1:mapData.plateauGrid[c][b]=0,a+=1}}function generateCollisionGrid(){var a=0;mapData.grid=[];for(var b,c=0;c<mapData.height;c++){mapData.grid[c]=[];for(b=0;b<mapData.width;b++)mapData.grid[c][b]=0}_.each(mapData.collisions,function(a){var b=tileIndexToGridPosition(a+1);mapData.grid[b.y][b.x]=1}),_.each(mapData.blocking,function(a){var b=tileIndexToGridPosition(a+1);mapData.grid[b.y]!==undefined&&(mapData.grid[b.y][b.x]=1)})}importScripts("../maps/world_client.js","lib/underscore.min.js"),onmessage=function(a){generateCollisionGrid(),generatePlateauGrid(),postMessage(mapData)}