function printStackTrace(a){var b=a&&a.e?a.e:null,c=a?!!a.guess:!0,d=new printStackTrace.implementation,e=d.run(b);return c?d.guessFunctions(e):e}define("storage",[],function(){var a=Class.extend({init:function(){this.hasLocalStorage()&&localStorage.data?this.data=JSON.parse(localStorage.data):this.resetData()},resetData:function(){this.data={hasAlreadyPlayed:!1,player:{name:"",weapon:"",armor:"",image:""},achievements:{unlocked:[],ratCount:0,skeletonCount:0,totalKills:0,totalDmg:0,totalRevives:0}}},hasLocalStorage:function(){return Modernizr.localstorage},save:function(){this.hasLocalStorage()&&(localStorage.data=JSON.stringify(this.data))},clear:function(){this.hasLocalStorage()&&(localStorage.data="",this.resetData())},hasAlreadyPlayed:function(){return this.data.hasAlreadyPlayed},initPlayer:function(a){this.data.hasAlreadyPlayed=!0,this.setPlayerName(a)},setPlayerName:function(a){this.data.player.name=a,this.save()},setPlayerImage:function(a){this.data.player.image=a,this.save()},setPlayerArmor:function(a){this.data.player.armor=a,this.save()},setPlayerWeapon:function(a){this.data.player.weapon=a,this.save()},savePlayer:function(a,b,c){this.setPlayerImage(a),this.setPlayerArmor(b),this.setPlayerWeapon(c)},hasUnlockedAchievement:function(a){return _.include(this.data.achievements.unlocked,a)},unlockAchievement:function(a){if(!this.hasUnlockedAchievement(a)){this.data.achievements.unlocked.push(a),this.save();return!0}return!1},getAchievementCount:function(){return _.size(this.data.achievements.unlocked)},getRatCount:function(){return this.data.achievements.ratCount},incrementRatCount:function(){this.data.achievements.ratCount<10&&(this.data.achievements.ratCount++,this.save())},getSkeletonCount:function(){return this.data.achievements.skeletonCount},incrementSkeletonCount:function(){this.data.achievements.skeletonCount<10&&(this.data.achievements.skeletonCount++,this.save())},getTotalDamageTaken:function(){return this.data.achievements.totalDmg},addDamage:function(a){this.data.achievements.totalDmg<5e3&&(this.data.achievements.totalDmg+=a,this.save())},getTotalKills:function(){return this.data.achievements.totalKills},incrementTotalKills:function(){this.data.achievements.totalKills<50&&(this.data.achievements.totalKills++,this.save())},getTotalRevives:function(){return this.data.achievements.totalRevives},incrementRevives:function(){this.data.achievements.totalRevives<5&&(this.data.achievements.totalRevives++,this.save())}});return a}),define("app",["jquery","storage"],function(a,b){var c=Class.extend({init:function(){this.currentPage=1,this.blinkInterval=null,this.previousState=null,this.isParchmentReady=!0,this.ready=!1,this.storage=new b,this.watchNameInputInterval=setInterval(this.toggleButton.bind(this),100),this.$playButton=a(".play"),this.$playDiv=a(".play div")},setGame:function(a){this.game=a,this.isMobile=this.game.renderer.mobile,this.isTablet=this.game.renderer.tablet,this.isDesktop=!this.isMobile&&!this.isTablet,this.supportsWorkers=!!window.Worker,this.ready=!0},center:function(){window.scrollTo(0,1)},canStartGame:function(){return this.isDesktop&&this.supportsWorkers?this.game&&this.game.map&&this.game.map.isLoaded:this.game},tryStartingGame:function(a,b){var c=this,d=this.$playButton;if(a!=="")if(!this.ready||!this.canStartGame()){this.isMobile||d.addClass("loading"),this.$playDiv.unbind("click");var e=setInterval(function(){log.debug("waiting..."),c.canStartGame()&&(setTimeout(function(){c.isMobile||d.removeClass("loading")},1500),clearInterval(e),c.startGame(a,b))},100)}else this.$playDiv.unbind("click"),this.startGame(a,b)},startGame:function(a,b){var c=this;b&&b(),this.hideIntro(function(){(!c.isDesktop||!this.supportsWorkers)&&c.game.loadMap(),c.start(a)})},start:function(b){var c=this,d=!c.storage.hasAlreadyPlayed();if(b&&!this.game.started){var e=!1,f=this.config;e||(log.debug("Starting game with build config."),this.game.setServerOptions(f.build.host,f.build.port,b)),this.center(),this.game.run(function(){a("body").addClass("started"),d&&c.toggleInstructions()})}},setMouseCoordinates:function(b){var c=a("#container").offset(),d=this.game.renderer.getScaleFactor(),e=this.game.renderer.getWidth(),f=this.game.renderer.getHeight(),g=this.game.mouse;g.x=b.pageX-c.left-(this.isMobile?0:5*d),g.y=b.pageY-c.top-(this.isMobile?0:7*d),g.x<=0?g.x=0:g.x>=e&&(g.x=e-1),g.y<=0?g.y=0:g.y>=f&&(g.y=f-1)},initHealthBar:function(){var b=this.game.renderer.getScaleFactor(),c=a("#healthbar").width()-12*b;this.game.onPlayerHealthChange(function(b,d){var e=Math.round(c/d*(b>0?b:0));a("#hitpoints").css("width",e+"px")}),this.game.onPlayerHurt(this.blinkHealthBar.bind(this))},blinkHealthBar:function(){var b=a("#hitpoints");b.addClass("white"),setTimeout(function(){b.removeClass("white")},500)},toggleButton:function(){var b=a("#parchment input").val(),c=a("#createcharacter .play");b&&b.length>0?(c.removeClass("disabled"),a("#character").removeClass("disabled")):(c.addClass("disabled"),a("#character").addClass("disabled"))},hideIntro:function(b){clearInterval(this.watchNameInputInterval),a("body").removeClass("intro"),setTimeout(function(){a("body").addClass("game"),b()},1e3)},showChat:function(){this.game.started&&(a("#chatbox").addClass("active"),a("#chatinput").focus(),a("#chatbutton").addClass("active"))},hideChat:function(){this.game.started&&(a("#chatbox").removeClass("active"),a("#chatinput").blur(),a("#chatbutton").removeClass("active"))},toggleInstructions:function(){a("#achievements").hasClass("active")&&(this.toggleAchievements(),a("#achievementsbutton").removeClass("active")),a("#instructions").toggleClass("active")},toggleAchievements:function(){a("#instructions").hasClass("active")&&(this.toggleInstructions(),a("#helpbutton").removeClass("active")),this.resetPage(),a("#achievements").toggleClass("active")},resetPage:function(){var b=this,c=a("#achievements");c.hasClass("active")&&c.bind(TRANSITIONEND,function(){c.removeClass("page"+b.currentPage).addClass("page1"),b.currentPage=1,c.unbind(TRANSITIONEND)})},initEquipmentIcons:function(){var b=this.game.renderer.getScaleFactor(),c=function(a){return"img/"+b+"/item-"+a+".png"},d=this.game.player.getWeaponName(),e=this.game.player.getSpriteName(),f=c(d),g=c(e);a("#weapon").css("background-image",'url("'+f+'")'),e!=="firefox"&&a("#armor").css("background-image",'url("'+g+'")')},hideWindows:function(){a("#achievements").hasClass("active")&&(this.toggleAchievements(),a("#achievementsbutton").removeClass("active")),a("#instructions").hasClass("active")&&(this.toggleInstructions(),a("#helpbutton").removeClass("active")),a("body").hasClass("credits")&&this.closeInGameCredits(),a("body").hasClass("about")&&this.closeInGameAbout()},showAchievementNotification:function(b,c){var d=a("#achievement-notification"),e=d.find(".name"),f=a("#achievementsbutton");d.removeClass().addClass("active achievement"+b),e.text(c),this.game.storage.getAchievementCount()===1&&(this.blinkInterval=setInterval(function(){f.toggleClass("blink")},500)),setTimeout(function(){d.removeClass("active"),f.removeClass("blink")},5e3)},displayUnlockedAchievement:function(b){var c=a("#achievements li.achievement"+b),d=this.game.getAchievementById(b);d&&d.hidden&&this.setAchievementData(c,d.name,d.desc),c.addClass("unlocked")},unlockAchievement:function(b,c){this.showAchievementNotification(b,c),this.displayUnlockedAchievement(b);var d=parseInt(a("#unlocked-achievements").text());a("#unlocked-achievements").text(d+1)},initAchievementList:function(b){var c=this,d=a("#lists"),e=a("#page-tmpl"),f=a("#achievement-tmpl"),g=0,h=0,i=null;_.each(b,function(b){h++;var j=f.clone();j.removeAttr("id"),j.addClass("achievement"+h),b.hidden||c.setAchievementData(j,b.name,b.desc),j.find(".twitter").attr("href","http://twitter.com/share?url=http%3A%2F%2Fbrowserquest.mozilla.org&text=I%20unlocked%20the%20%27"+b.name+"%27%20achievement%20on%20Mozilla%27s%20%23BrowserQuest%21&related=glecollinet:Creators%20of%20BrowserQuest%2Cwhatthefranck"),j.show(),j.find("a").click(function(){var b=a(this).attr("href");c.openPopup("twitter",b);return!1}),(h-1)%4===0&&(g++,i=e.clone(),i.attr("id","page"+g),i.show(),d.append(i)),i.append(j)}),a("#total-achievements").text(a("#achievements").find("li").length)},initUnlockedAchievements:function(b){var c=this;_.each(b,function(a){c.displayUnlockedAchievement(a)}),a("#unlocked-achievements").text(b.length)},setAchievementData:function(a,b,c){a.find(".achievement-name").html(b),a.find(".achievement-description").html(c)},toggleCredits:function(){var b=a("#parchment").attr("class");this.game.started?(a("#parchment").removeClass().addClass("credits"),a("body").toggleClass("credits"),this.game.player||a("body").toggleClass("death"),a("body").hasClass("about")&&(this.closeInGameAbout(),a("#helpbutton").removeClass("active"))):b!=="animate"&&(b==="credits"?this.animateParchment(b,this.previousState):(this.animateParchment(b,"credits"),this.previousState=b))},toggleAbout:function(){var b=a("#parchment").attr("class");this.game.started?(a("#parchment").removeClass().addClass("about"),a("body").toggleClass("about"),this.game.player||a("body").toggleClass("death"),a("body").hasClass("credits")&&this.closeInGameCredits()):b!=="animate"&&(b==="about"?localStorage&&localStorage.data?this.animateParchment(b,"loadcharacter"):this.animateParchment(b,"createcharacter"):(this.animateParchment(b,"about"),this.previousState=b))},closeInGameCredits:function(){a("body").removeClass("credits"),a("#parchment").removeClass("credits"),this.game.player||a("body").addClass("death")},closeInGameAbout:function(){a("body").removeClass("about"),a("#parchment").removeClass("about"),this.game.player||a("body").addClass("death"),a("#helpbutton").removeClass("active")},togglePopulationInfo:function(){a("#population").toggleClass("visible")},openPopup:function(b,c){var d=a(window).height(),e=a(window).width(),f,g,h,i;switch(b){case"twitter":f=450,g=550;break;case"facebook":f=400,g=580}h=d/2-f/2,i=e/2-g/2,newwindow=window.open(c,"name","height="+f+",width="+g+",top="+h+",left="+i),window.focus&&newwindow.focus()},animateParchment:function(b,c){var d=this,e=a("#parchment"),f=1;this.isMobile?e.removeClass(b).addClass(c):this.isParchmentReady&&(this.isTablet&&(f=0),this.isParchmentReady=!this.isParchmentReady,e.toggleClass("animate"),e.removeClass(b),setTimeout(function(){a("#parchment").toggleClass("animate"),e.addClass(c)},f*1e3),setTimeout(function(){d.isParchmentReady=!d.isParchmentReady},f*1e3))},animateMessages:function(){var b=a("#notifications div");b.addClass("top")},resetMessagesPosition:function(){var b=a("#message2").text();a("#notifications div").removeClass("top"),a("#message2").text(""),a("#message1").text(b)},showMessage:function(b){var c=a("#notifications div"),d=a("#notifications #message2");this.animateMessages(),d.text(b),this.messageTimer&&this.resetMessageTimer(),this.messageTimer=setTimeout(function(){c.addClass("top")},5e3)},resetMessageTimer:function(){clearTimeout(this.messageTimer)},resizeUi:function(){if(this.game)if(this.game.started)this.game.resize(),this.initHealthBar(),this.game.updateBars();else{var a=this.game.renderer.getScaleFactor();this.game.renderer.rescale(a)}}});return c}),define("main",["jquery","app"],function(a,b){var c,d,e=function(){a(document).ready(function(){c=new b,c.center(),Detect.isWindows()&&a("body").addClass("windows"),Detect.isOpera()&&a("body").addClass("opera"),a("body").click(function(b){a("#parchment").hasClass("credits")&&c.toggleCredits(),a("#parchment").hasClass("about")&&c.toggleAbout()}),a(".barbutton").click(function(){a(this).toggleClass("active")}),a("#chatbutton").click(function(){a("#chatbutton").hasClass("active")?c.showChat():c.hideChat()}),a("#helpbutton").click(function(){c.toggleAbout()}),a("#achievementsbutton").click(function(){c.toggleAchievements(),c.blinkInterval&&clearInterval(c.blinkInterval),a(this).removeClass("blink")}),a("#instructions").click(function(){c.hideWindows()}),a("#playercount").click(function(){c.togglePopulationInfo()}),a("#population").click(function(){c.togglePopulationInfo()}),a(".clickable").click(function(a){a.stopPropagation()}),a("#toggle-credits").click(function(){c.toggleCredits()}),a("#create-new span").click(function(){c.animateParchment("loadcharacter","confirmation")}),a(".delete").click(function(){c.storage.clear(),c.animateParchment("confirmation","createcharacter")}),a("#cancel span").click(function(){c.animateParchment("confirmation","loadcharacter")}),a(".ribbon").click(function(){c.toggleAbout()}),a("#nameinput").bind("keyup",function(){c.toggleButton()}),a("#previous").click(function(){var b=a("#achievements");if(c.currentPage===1)return!1;c.currentPage-=1,b.removeClass().addClass("active page"+c.currentPage)}),a("#next").click(function(){var b=a("#achievements"),d=a("#lists"),e=d.children("ul").length;if(c.currentPage===e)return!1;c.currentPage+=1,b.removeClass().addClass("active page"+c.currentPage)}),a("#notifications div").bind(TRANSITIONEND,c.resetMessagesPosition.bind(c)),a(".close").click(function(){c.hideWindows()}),a(".twitter").click(function(){var b=a(this).attr("href");c.openPopup("twitter",b);return!1}),a(".facebook").click(function(){var b=a(this).attr("href");c.openPopup("facebook",b);return!1});var d=c.storage.data;d.hasAlreadyPlayed&&d.player.name&&d.player.name!==""&&(a("#playername").html(d.player.name),a("#playerimage").attr("src",d.player.image)),a(".play div").click(function(b){var d=a("#nameinput").attr("value"),e=a("#playername").html(),f=d||e;c.tryStartingGame(f)}),document.addEventListener("touchstart",function(){},!1),a("#resize-check").bind("transitionend",c.resizeUi.bind(c)),a("#resize-check").bind("webkitTransitionEnd",c.resizeUi.bind(c)),a("#resize-check").bind("oTransitionEnd",c.resizeUi.bind(c)),log.info("App initialized."),f()})},f=function(){require(["game"],function(b){var e=document.getElementById("entities"),f=document.getElementById("background"),g=document.getElementById("foreground"),h=document.getElementById("chatinput");d=new b(c),d.setup("#bubbles",e,f,g,h),d.setStorage(c.storage),c.setGame(d),c.isDesktop&&c.supportsWorkers&&d.loadMap(),d.onGameStart(function(){c.initEquipmentIcons()}),d.onDisconnect(function(b){a("#death").find("p").html(b+"<em>Please reload the page.</em>"),a("#respawn").hide()}),d.onPlayerDeath(function(){a("body").hasClass("credits")&&a("body").removeClass("credits"),a("body").addClass("death")}),d.onPlayerEquipmentChange(function(){c.initEquipmentIcons()}),d.onPlayerInvincible(function(){a("#hitpoints").toggleClass("invincible")}),d.onNbPlayersChange(function(b,c){var d=function(b){a("#instance-population").find("span:nth-child(2)").text(b),a("#playercount").find("span:nth-child(2)").text(b)},e=function(b){a("#world-population").find("span:nth-child(2)").text(b)};a("#playercount").find("span.count").text(b),a("#instance-population").find("span").text(b),b==1?d("player"):d("players"),a("#world-population").find("span").text(c),c==1?e("player"):e("players")}),d.onAchievementUnlock(function(a,b,d){c.unlockAchievement(a,b)}),d.onNotification(function(a){c.showMessage(a)}),c.initHealthBar(),a("#nameinput").attr("value",""),a("#chatbox").attr("value",""),d.renderer.mobile||d.renderer.tablet?a("#foreground").bind("touchstart",function(a){c.center(),c.setMouseCoordinates(a.originalEvent.touches[0]),d.click(),c.hideWindows()}):a("#foreground").click(function(a){c.center(),c.setMouseCoordinates(a),d&&d.click(),c.hideWindows()}),a("body").unbind("click"),a("body").click(function(b){var e=!1;a("#parchment").hasClass("credits")&&(d.started?(c.closeInGameCredits(),e=!0):c.toggleCredits()),a("#parchment").hasClass("about")&&(d.started?(c.closeInGameAbout(),e=!0):c.toggleAbout()),d.started&&!d.renderer.mobile&&d.player&&!e&&d.click()}),a("#respawn").click(function(b){d.audioManager.playSound("revive"),d.restart(),a("body").removeClass("death")}),a(document).mousemove(function(a){c.setMouseCoordinates(a),d.started&&d.movecursor()}),a(document).keydown(function(b){var d=b.which,e=a("#chatinput");d===13&&(a("#chatbox").hasClass("active")?c.hideChat():c.showChat())}),a("#chatinput").keydown(function(b){var e=b.which,f=a("#chatinput");if(e===13){if(f.attr("value")!==""){d.player&&d.say(f.attr("value")),f.attr("value",""),c.hideChat(),a("#foreground").focus();return!1}c.hideChat();return!1}if(e===27){c.hideChat();return!1}}),a("#nameinput").keypress(function(b){var d=a("#nameinput"),e=d.attr("value");if(b.keyCode===13){if(e!==""){c.tryStartingGame(e,function(){d.blur()});return!1}return!1}}),a("#mutebutton").click(function(){d.audioManager.toggle()}),a(document).bind("keydown",function(b){var e=b.which,f=a("#chatinput");if(a("#chatinput:focus").size()==0&&a("#nameinput:focus").size()==0){if(e===13&&d.ready){f.focus();return!1}if(e===32)return!1;if(e===70)return!1;if(e===27){c.hideWindows(),_.each(d.player.attackers,function(a){a.stop()});return!1}if(e===65)return!1}else if(e===13&&d.ready){f.focus();return!1}}),d.renderer.tablet&&a("body").addClass("tablet")})};e()});var initializing=!1,fnTest=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;Class=function(){},Class.extend=function(a){var b=this.prototype;initializing=!0;var c=new this;initializing=!1;for(var d in a)c[d]=typeof a[d]=="function"&&typeof b[d]=="function"&&fnTest.test(a[d])?function(a,c){return function(){var d=this._super;this._super=b[a];var e=c.apply(this,arguments);this._super=d;return e}}(d,a[d]):a[d];Class=function(){!initializing&&this.init&&this.init.apply(this,arguments)},Class.prototype=c,Class.constructor=Class,Class.extend=arguments.callee;return Class},typeof exports!="undefined"&&(exports.Class=Class),define("lib/class",function(){}),function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=d.slice,g=d.unshift,h=e.toString,i=e.hasOwnProperty,j=d.forEach,k=d.map,l=d.reduce,m=d.reduceRight,n=d.filter,o=d.every,p=d.some,q=d.indexOf,r=d.lastIndexOf;e=Array.isArray;var s=Object.keys,t=Function.prototype.bind,u=function(a){return new z(a)};typeof module!="undefined"&&module.exports?(module.exports=u,u._=u):a._=u,u.VERSION="1.1.7";var v=u.each=u.forEach=function(a,b,d){if(a!=null)if(j&&a.forEach===j)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;e<f;e++)if(e in a&&b.call(d,a[e],e,a)===c)break}else for(e in a)if(i.call(a,e)&&b.call(d,a[e],e,a)===c)break};u.map=function(a,b,c){var d=[];if(a==null)return d;if(k&&a.map===k)return a.map(b,c);v(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)});return d},u.reduce=u.foldl=u.inject=function(a,b,c,d){var e=c!==void 0;a==null&&(a=[]);if(l&&a.reduce===l)return d&&(b=u.bind(b,d)),e?a.reduce(b,c):a.reduce(b);v(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)});if(!e)throw new TypeError("Reduce of empty array with no initial value");return c},u.reduceRight=u.foldr=function(a,b,c,d){a==null&&(a=[]);if(m&&a.reduceRight===m)return d&&(b=u.bind(b,d)),c!==void 0?a.reduceRight(b,c):a.reduceRight(b);a=(u.isArray(a)?a.slice():u.toArray(a)).reverse();return u.reduce(a,b,c,d)},u.find=u.detect=function(a,b,c){var d;w(a,function(a,e,f){if(b.call(c,a,e,f))return d=a,!0});return d},u.filter=u.select=function(a,b,c){var d=[];if(a==null)return d;if(n&&a.filter===n)return a.filter(b,c);v(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)});return d},u.reject=function(a,b,c){var d=[];if(a==null)return d;v(a,function(a,e,f){b.call(c,a,e,f)||(d[d.length]=a)});return d},u.every=u.all=function(a,b,d){var e=!0;if(a==null)return e;if(o&&a.every===o)return a.every(b,d);v(a,function(a,f,g){if(!(e=e&&b.call(d,a,f,g)))return c});return e};var w=u.some=u.any=function(a,b,d){b=b||u.identity;var e=!1;if(a==null)return e;if(p&&a.some===p)return a.some(b,d);v(a,function(a,f,g){if(e|=b.call(d,a,f,g))return c});return!!e};u.include=u.contains=function(a,b){var c=!1;if(a==null)return c;if(q&&a.indexOf===q)return a.indexOf(b)!=-1;w(a,function(a){if(c=a===b)return!0});return c},u.invoke=function(a,b){var c=f.call(arguments,2);return u.map(a,function(a){return(b.call?b||a:a[b]).apply(a,c)})},u.pluck=function(a,b){return u.map(a,function(a){return a[b]})},u.max=function(a,b,c){if(!b&&u.isArray(a))return Math.max.apply(Math,a);var d={computed:-Infinity};v(a,function(a,e,f){e=b?b.call(c,a,e,f):a,e>=d.computed&&(d={value:a,computed:e})});return d.value},u.min=function(a,b,c){if(!b&&u.isArray(a))return Math.min.apply(Math,a);var d={computed:Infinity};v(a,function(a,e,f){e=b?b.call(c,a,e,f):a,e<d.computed&&(d={value:a,computed:e})});return d.value},u.sortBy=function(a,b,c){return u.pluck(u.map(a,function(a,d,e){return{value:a,criteria:b.call(c,a,d,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;return c<d?-1:c>d?1:0}),"value")},u.groupBy=function(a,b){var c={};v(a,function(a,d){var e=b(a,d);(c[e]||(c[e]=[])).push(a)});return c},u.sortedIndex=function(a,b,c){c||(c=u.identity);for(var d=0,e=a.length;d<e;){var f=d+e>>1;c(a[f])<c(b)?d=f+1:e=f}return d},u.toArray=function(a){return a?a.toArray?a.toArray():u.isArray(a)?f.call(a):u.isArguments(a)?f.call(a):u.values(a):[]},u.size=function(a){return u.toArray(a).length},u.first=u.head=function(a,b,c){return b!=null&&!c?f.call(a,0,b):a[0]},u.rest=u.tail=function(a,b,c){return f.call(a,b==null||c?1:b)},u.last=function(a){return a[a.length-1]},u.compact=function(a){return u.filter(a,function(a){return!!a})},u.flatten=function(a){return u.reduce(a,function(a,b){if(u.isArray(b))return a.concat(u.flatten(b));a[a.length]=b;return a},[])},u.without=function(a){return u.difference(a,f.call(arguments,1))},u.uniq=u.unique=function(a,b){return u.reduce(a,function(a,c,d){if(0==d||(b===!0?u.last(a)!=c:!u.include(a,c)))a[a.length]=c;return a},[])},u.union=function(){return u.uniq(u.flatten(arguments))},u.intersection=u.intersect=function(a){var b=f.call(arguments,1);return u.filter(u.uniq(a),function(a){return u.every(b,function(b){return u.indexOf(b,a)>=0})})},u.difference=function(a,b){return u.filter(a,function(a){return!u.include(b,a)})},u.zip=function(){for(var a=f.call(arguments),b=u.max(u.pluck(a,"length")),c=Array(b),d=0;d<b;d++)c[d]=u.pluck(a,""+d);return c},u.indexOf=function(a,b,c){if(a==null)return-1;var d;if(c)return c=u.sortedIndex(a,b),a[c]===b?c:-1;if(q&&a.indexOf===q)return a.indexOf(b);c=0;for(d=a.length;c<d;c++)if(a[c]===b)return c;return-1},u.lastIndexOf=function(a,b){if(a==null)return-1;if(r&&a.lastIndexOf===r)return a.lastIndexOf(b);for(var c=a.length;c--;)if(a[c]===b)return c;return-1},u.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=Array(d);e<d;)f[e++]=a,a+=c;return f},u.bind=function(a,b){if(a.bind===t&&t)return t.apply(a,f.call(arguments,1));var c=f.call(arguments,2);return function(){return a.apply(b,c.concat(f.call(arguments)))}},u.bindAll=function(a){var b=f.call(arguments,1);b.length==0&&(b=u.functions(a)),v(b,function(b){a[b]=u.bind(a[b],a)});return a},u.memoize=function(a,b){var c={};b||(b=u.identity);return function(){var d=b.apply(this,arguments);return i.call(c,d)?c[d]:c[d]=a.apply(this,arguments)}},u.delay=function(a,b){var c=f.call(arguments,2);return setTimeout(function(){return a.apply(a,c)},b)},u.defer=function(a){return u.delay.apply(u,[a,1].concat(f.call(arguments,1)))};var x=function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,a.apply(e,f)};c&&clearTimeout(d);if(c||!d)d=setTimeout(g,b)}};u.throttle=function(a,b){return x(a,b,!1)},u.debounce=function(a,b){return x(a,b,!0)},u.once=function(a){var b=!1,c;return function(){if(b)return c;b=!0;return c=a.apply(this,arguments)}},u.wrap=function(a,b){return function(){var c=[a].concat(f.call(arguments));return b.apply(this,c)}},u.compose=function(){var a=f.call(arguments);return function(){for(var b=f.call(arguments),c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},u.after=function(a,b){return function(){if(--a<1)return b.apply(this,arguments)}},u.keys=s||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[],c;for(c in a)i.call(a,c)&&(b[b.length]=c);return b},u.values=function(a){return u.map(a,u.identity)},u.functions=u.methods=function(a){var b=[],c;for(c in a)u.isFunction(a[c])&&b.push(c);return b.sort()},u.extend=function(a){v(f.call(arguments,1),function(b){for(var c in b)b[c]!==void 0&&(a[c]=b[c])});return a},u.defaults=function(a){v(f.call(arguments,1),function(b){for(var c in b)a[c]==null&&(a[c]=b[c])});return a},u.clone=function(a){return u.isArray(a)?a.slice():u.extend({},a)},u.tap=function(a,b){b(a);return a},u.isEqual=function(a,b){if(a===b)return!0;var c=typeof a;if(c!=typeof b)return!1;if(a==b)return!0;if(!a&&b||a&&!b)return!1;a._chain&&(a=a._wrapped),b._chain&&(b=b._wrapped);if(a.isEqual)return a.isEqual(b);if(b.isEqual)return b.isEqual(a);if(u.isDate(a)&&u.isDate(b))return a.getTime()===b.getTime();if(u.isNaN(a)&&u.isNaN(b))return!1;if(u.isRegExp(a)&&u.isRegExp(b))return a.source===b.source&&a.global===b.global&&a.ignoreCase===b.ignoreCase&&a.multiline===b.multiline;if(c!=="object")return!1;if(a.length&&a.length!==b.length)return!1;c=u.keys(a);var d=u.keys(b);if(c.length!=d.length)return!1;for(var e in a)if(!(e in b)||!u.isEqual(a[e],b[e]))return!1;return!0},u.isEmpty=function(a){if(u.isArray(a)||u.isString(a))return a.length===0;for(var b in a)if(i.call(a,b))return!1;return!0},u.isElement=function(a){return!!a&&a.nodeType==1},u.isArray=e||function(a){return h.call(a)==="[object Array]"},u.isObject=function(a){return a===Object(a)},u.isArguments=function(a){return!!a&&!!i.call(a,"callee")},u.isFunction=function(a){return!(!a||!a.constructor||!a.call||!a.apply)},u.isString=function(a){return!!(a===""||a&&a.charCodeAt&&a.substr)},u.isNumber=function(a){return!!(a===0||a&&a.toExponential&&a.toFixed)},u.isNaN=function(a){return a!==a},u.isBoolean=function(a){return a===!0||a===!1},u.isDate=function(a){return!(!a||!a.getTimezoneOffset||!a.setUTCFullYear)},u.isRegExp=function(a){return!(!a||!a.test||!a.exec||!a.ignoreCase&&a.ignoreCase!==!1)},u.isNull=function(a){return a===null},u.isUndefined=function(a){return a===void 0},u.noConflict=function(){a._=b;return this},u.identity=function(a){return a},u.times=function(a,b,c){for(var d=0;d<a;d++)b.call(c,d)},u.mixin=function(a){v(u.functions(a),function(b){B(b,u[b]=a[b])})};var y=0;u.uniqueId=function(a){var b=y++;return a?a+b:b},u.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g},u.template=function(a,b){var c=u.templateSettings;c="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+a.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(c.interpolate,function(a,b){return"',"+b.replace(/\\'/g,"'")+",'"}).replace(c.evaluate||null,function(a,b){return"');"+b.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",c=new Function("obj",c);return b?c(b):c};var z=function(a){this._wrapped=a};u.prototype=z.prototype;var A=function(a,b){return b?u(a).chain():a},B=function(a,b){z.prototype[a]=function(){var a=f.call(arguments);g.call(a,this._wrapped);return A(b.apply(u,a),this._chain)}};u.mixin(u),v(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];z.prototype[a]=function(){b.apply(this._wrapped,arguments);return A(this._wrapped,this._chain)}}),v(["concat","join","slice"],function(a){var b=d[a];z.prototype[a]=function(){return A(b.apply(this._wrapped,arguments),this._chain)}}),z.prototype.chain=function(){this._chain=!0;return this},z.prototype.value=function(){return this._wrapped}}(),define("lib/underscore.min",function(){}),printStackTrace.implementation=function(){},printStackTrace.implementation.prototype={run:function(a){var b=this._mode||this.mode();if(b==="other")return this.other(arguments.callee);a=a||function(){try{var a=__undef__<<1}catch(b){return b}}();return this[b](a)},mode:function(){try{var a=__undef__<<1}catch(b){if(b.arguments)return this._mode="chrome";if(window.opera&&b.stacktrace)return this._mode="opera10";if(b.stack)return this._mode="firefox";if(window.opera&&!("stacktrace"in b))return this._mode="opera"}return this._mode="other"},instrumentFunction:function(a,b,c){a=a||window,a["_old"+b]=a[b],a[b]=function(){c.call(this,printStackTrace());return a["_old"+b].apply(this,arguments)},a[b]._instrumented=!0},deinstrumentFunction:function(a,b){a[b].constructor===Function&&a[b]._instrumented&&a["_old"+b].constructor===Function&&(a[b]=a["_old"+b])},chrome:function(a){return a.stack.replace(/^[^\n]*\n/,"").replace(/^[^\n]*\n/,"").replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@").split("\n")},firefox:function(a){return a.stack.replace(/^[^\n]*\n/,"").replace(/(?:\n@:0)?\s+$/m,"").replace(/^\(/gm,"{anonymous}(").split("\n")},opera10:function(a){var b=a.stacktrace,c=b.split("\n"),d="{anonymous}",e=/.*line (\d+), column (\d+) in ((<anonymous function\:?\s*(\S+))|([^\(]+)\([^\)]*\))(?: in )?(.*)\s*$/i,f,g,h;for(f=2,g=0,h=c.length;f<h-2;f++)if(e.test(c[f])){var i=RegExp.$6+":"+RegExp.$1+":"+RegExp.$2,j=RegExp.$3;j=j.replace(/<anonymous function\s?(\S+)?>/g,d),c[g++]=j+"@"+i}c.splice(g,c.length-g);return c},opera:function(a){var b=a.message.split("\n"),c="{anonymous}",d=/Line\s+(\d+).*script\s+(http\S+)(?:.*in\s+function\s+(\S+))?/i,e,f,g;for(e=4,f=0,g=b.length;e<g;e+=2)d.test(b[e])&&(b[f++]=(RegExp.$3?RegExp.$3+"()@"+RegExp.$2+RegExp.$1:c+"()@"+RegExp.$2+":"+RegExp.$1)+" -- "+b[e+1].replace(/^\s+/,""));b.splice(f,b.length-f);return b},other:function(a){var b="{anonymous}",c=/function\s*([\w\-$]+)?\s*\(/i,d=[],e=0,f,g,h=10;while(a&&d.length<h)f=c.test(a.toString())?RegExp.$1||b:b,g=Array.prototype.slice.call(a.arguments),d[e++]=f+"("+this.stringifyArguments(g)+")",a=a.caller;return d},stringifyArguments:function(a){for(var b=0;b<a.length;++b){var c=a[b];c===undefined?a[b]="undefined":c===null?a[b]="null":c.constructor&&(c.constructor===Array?c.length<3?a[b]="["+this.stringifyArguments(c)+"]":a[b]="["+this.stringifyArguments(Array.prototype.slice.call(c,0,1))+"..."+this.stringifyArguments(Array.prototype.slice.call(c,-1))+"]":c.constructor===Object?a[b]="#object":c.constructor===Function?a[b]="#function":c.constructor===String&&(a[b]='"'+c+'"'))}return a.join(",")},sourceCache:{},ajax:function(a){var b=this.createXMLHTTPObject();if(!!b){b.open("GET",a,!1),b.setRequestHeader("User-Agent","XMLHTTP/1.0"),b.send("");return b.responseText}},createXMLHTTPObject:function(){var a,b=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];for(var c=0;c<b.length;c++)try{a=b[c](),this.createXMLHTTPObject=b[c];return a}catch(d){}},isSameDomain:function(a){return a.indexOf(location.hostname)!==-1},getSource:function(a){a in this.sourceCache||(this.sourceCache[a]=this.ajax(a).split("\n"));return this.sourceCache[a]},guessFunctions:function(a){for(var b=0;b<a.length;++b){var c=/\{anonymous\}\(.*\)@(\w+:\/\/([\-\w\.]+)+(:\d+)?[^:]+):(\d+):?(\d+)?/,d=a[b],e=c.exec(d);if(e){var f=e[1],g=e[4];if(f&&this.isSameDomain(f)&&g){var h=this.guessFunctionName(f,g);a[b]=d.replace("{anonymous}",h)}}}return a},guessFunctionName:function(a,b){try{return this.guessFunctionNameFromLines(b,this.getSource(a))}catch(c){return"getSource failed with url: "+a+", exception: "+c.toString()}},guessFunctionNameFromLines:function(a,b){var c=/function ([^(]*)\(([^)]*)\)/,d=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(function|eval|new Function)/,e="",f=10;for(var g=0;g<f;++g){e=b[a-g]+e;if(e!==undefined){var h=d.exec(e);if(h&&h[1])return h[1];h=c.exec(e);if(h&&h[1])return h[1]}}return"(?)"}},define("lib/stacktrace",function(){}),Function.prototype.bind=function(a){var b=this;return function(){var c=Array.prototype.slice.call(arguments);return b.apply(a||null,c)}};var isInt=function(a){return a%1===0},TRANSITIONEND="transitionend webkitTransitionEnd oTransitionEnd";window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1e3/60)}}(),define("util",function(){}),define("home",["lib/class","lib/underscore.min","lib/stacktrace","util"],function(){require(["main"])})